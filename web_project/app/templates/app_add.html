{% extends "base.html" %}

{% block link %}

<link rel="stylesheet" href="{{ STATIC_URL }}file_upload/css/style.css" xmlns="http://www.w3.org/1999/html"
      xmlns="http://www.w3.org/1999/html">
    <link rel="stylesheet" href="{{ STATIC_URL }}file_upload/css/jquery.fileupload-ui.css">
    <link rel="stylesheet" href="{{ STATIC_URL }}file_upload/css/jquery.fileupload.css">

    <style type="text/css">
    </style>
    
{% endblock %}


{% block content%}
    <div id="form_div">
    <h3>应用详情&nbsp;*&nbsp;为必填项</h3>
    <hr>

    <div  class="row-fluid">
        <div class="span1">
        </div>

        <div class="span2">
            <h4>应用上传</h4>
        </div>

        <div class="span6">

            <span id="upload_file_button" class="btn btn-success fileinput-button  btn-large ">

                    <span>+ Add Apk file...</span>
                    <input id="file-apk-upload" type="file" name="files[]" multiple>
             </span><span class="text-error" style="margin-left: 16px;font-size: x-large ;font-weight: bold">相同的应用包不能重复上传！</span>

           <div id="upload_file_success" class="alert alert-success" style="display: none;font-size: 20px">
               <button type="button" class="close">重新上传</button>
               <strong>Well done!</strong>  successfully upload apk file onto server.
           </div>

            <div id="apk-progress" class="progress progress-success progress-striped active" style="display: none">
                <div class="bar"></div>
            </div>
            <!--<input id='upload-apk-url' name="upload-apk-url" class="input-xlarge" type="hidden">-->
        </div>
    </div>
    </br>

    <div class="row-fluid">
        <div class="span1">
        </div>

        <div class="span2">
            <h4>应用LOGO</h4>
        </div>

        <div class="span6">
            <span id="icon_file_button" class="btn btn-success fileinput-button  btn-large ">
                    <span>+ Add Icon...</span>
                    <input id="file-logo-img-upload" type="file" name="files[]" accept="image/png, image/gif, image/jpg, image/jpeg" multiple>
            </span> <span class="text-error" style="margin-left: 16px;font-size: x-large ;font-weight: bold">*</span>

           <div id="icon_file_success" class="alert alert-success" style="display: none;font-size: 20px">
               <button type="button" class="close">&times;</button>
               <img id='logo-img-content' src="" class="img-polaroid" height="100" width="120"/>
           </div>
            <div id="logo-progress" class="progress progress-success progress-striped active" style="display: none">
                <div class="bar"></div>
            </div>
            <input type='hidden' id='logo-img-input' name='log-img' />
        </div>
    </div>

    </br>

    <div class="row-fluid">
        <div class="span1">
        </div>

        <div class="span2">
            <h4>应用轮播图</h4>
        </div>

        <div class="span6">

            <span id="img_file_button" class="btn btn-success fileinput-button  btn-large ">
                    <span>+ Add Image...</span>
                    <input id="file-scoller-img-upload" type="file" name="files[]" multiple>
            </span>

           <div id="img_file_success" class="alert alert-success" style="display: none;font-size: 20px">
               <button type="button" class="close">&times;</button>
               <img id='scoller-img-content' src="" class="img-polaroid" >
           </div>

            <div id="scoller-progress" class="progress progress-success progress-striped  active" style="display: none">
                <div class="bar"></div>
            </div>

            <input type='hidden' id='scoller-img-input' name='scoller-img' />
            <span class="text-error" style="margin-left: 16px;font-size: x-large ;font-weight: bold">轮播图尺寸800*380，1M以内</span>
        </div>

    </div>

    </br>
    <div class="row-fluid">
        <div class="span1">
        </div>

        <div class="span2">
            <h4>新应用轮播图</h4>
        </div>

        <div class="span6">

            <span id="img2_file_button" class="btn btn-success fileinput-button  btn-large ">
                    <span>+ Add Image...</span>
                    <input id="file2-scoller-img-upload" type="file" name="files[]" multiple>
            </span>

           <div id="img2_file_success" class="alert alert-success" style="display: none;font-size: 20px">
               <button type="button" class="close">&times;</button>
               <img id='scoller2-img-content' src="" class="img-polaroid" >
           </div>

            <div id="scoller2-progress" class="progress progress-success progress-striped  active" style="display: none">
                <div class="bar"></div>
            </div>

            <input type='hidden' id='scoller2-img-input' name='scoller2-img' />
            <span class="text-error" style="margin-left: 16px;font-size: x-large ;font-weight: bold">轮播图尺寸800*270，1M以内</span>
        </div>

    </div>

    <hr>

    <form id='app-info'  method="post">{% csrf_token %}
        <div class="row-fluid">
            <div class="span1">
            </div>
            <div class="span2">
                <h4>应用名称</h4>
            </div>

            <div class="span6">
                 <input id='appname' name='appname' class="input-xlarge" type="text">
                 <span class="text-error" style="margin-left: 16px;font-size: x-small ;font-weight: bold">* 由于浏览器问题，游戏名解析可能显示乱码，请注意校验，并手动编辑修改为正确格式。</span>
            </div>

            <div class="span1">

            </div>

        </div>

        <div class="row-fluid">
            <div class="span1">
            </div>
            <div class="span2">
                <h4>游戏类型：</h4>
            </div>

            <div class="span6">

                <select name="game_categories" class="input-xlarge" id="game_categories" >
                    <option value="" selected="selected">空</option>
                    {% for gametype in gametypes %}
                        <option value="{{ gametype.id }}">{{ gametype.name }}</option>

                    {% endfor %}
                </select>
                <span class="text-error" style="margin-left: 16px;font-size: x-large ;font-weight: bold">*</span>
            </div>

            <div class="span1">

            </div>
        </div>

        </br>
        <div class="row-fluid">
            <div class="span1">
            </div>
            <div class="span2">
                <h4>下载地址</h4>
            </div>

            <div class="span6">
                 <input id='upload-apk-url' name="upload-apk-url" class="input-xlarge" type="text" value="">
                 <span class="text-error" style="margin-left: 16px;font-size: x-large ;font-weight: bold">*</span>
            </div>

            <div class="span1">

            </div>
        </div>

        </br>

    <div class="row-fluid">
        <div class="span1">
        </div>
        <div class="span2">
            <h4>源下载地址</h4>
        </div>

        <div class="span6">
            <input id='upload-apk-source-url' name="upload-apk-source-url" class="input-xlarge" type="text" value="">
            <span class="text-error" style="margin-left: 16px;font-size: x-large ;font-weight: bold">*</span>
        </div>

        <div class="span1">

        </div>
    </div>

    </br>

        <div class="row-fluid">
            <div class="span1">
            </div>
            <div class="span2">
                <h4>MD5</h4>
            </div>

            <div class="span6">
                 <h6 id="md5-show"></h6>
                 <input id='md5-input' name="md5-input" class="input-xlarge" type="hidden" value="">
            </div>

            <div class="span1">

            </div>
        </div>
        <br>

        <div class="row-fluid">
            <div class="span1">
            </div>
            <div class="span2">
                <h4>软件包名</h4>
            </div>

            <div class="span6">
                 <input id='package' name="package" class="input-xlarge" type="text">
                 <span class="text-error" style="margin-left: 16px;font-size: x-large ;font-weight: bold">*</span>
            </div>

            <div class="span1">

            </div>
        </div>
        </br>

        <div class="row-fluid">
            <div class="span1">
            </div>
            <div class="span2">
                <h4>Activity</h4>
            </div>

            <div class="span6">
                 <input id='activity' name="activity" class="input-xlarge" type="text">
                 <span class="text-error" style="margin-left: 16px;font-size: x-large ;font-weight: bold">*</span>
            </div>

            <div class="span1">

            </div>
        </div>
        </br>

        <div class="row-fluid">
                <div class="span1">
            </div>
            <div class="span2">
                <h4>应用简介</h4>
            </div>

            <div class="span6">
                <textarea id='desc' name='desc' rows="3"></textarea>
                <span class="text-error" style="margin-left: 16px;font-size: x-large ;font-weight: bold">*</span>

            </div>

            <div class="span1">
            </div>
        </div>
        </br>

        <div class="row-fluid">
                <div class="span1">
            </div>
            <div class="span2">
                <h4>应用短描述</h4>
            </div>

            <div class="span6">
                <textarea id='short-desc' name='desc' rows="3" value=""></textarea>
                <span class="text-error" style="margin-left: 16px;font-size: x-large ;font-weight: bold">*</span>

            </div>

            <div class="span1">
            </div>
        </div>
        </br>

        <div class="row-fluid">
            <div class="span1">

            </div>
            <div class="span2">
                <h4>应用状态</h4>
            </div>
            <div class="span6">

                <select id='select-status'>
                    <option value="1" selected="selected">上架</option>
                    <option value="0">下架</option>
                </select>

            </div>
        </div>
        <br>

        <div class="row-fluid">
            <div class="span1">

            </div>
            <div class="span2">
                <h4>是否强制升级</h4>
            </div>
            <div class="span6">

                <select id='force-update'>
                    <option value="0" selected="selected">不强制升级</option>
                    <option value="1">强制升级</option>
                </select>

            </div>
        </div>
        <br>

        <div class="row-fluid">
            <div class="span1">
            </div>
            <div class="span2">
                <h4>升级信息</h4>
            </div>

            <div class="span6">
                 <textarea id='update-info' name="update-info" class="input-xlarge"></textarea>
            </div>

            <div class="span1">
            </div>
        </div>
        </br>

        <div class="row-fluid">
            <div class="span1">
            </div>
            <div class="span2">
                <h4>版本号</h4>
            </div>

            <div class="span6">
                 <input id='ver-num' name="ver_num" class="input-xlarge" type="text">
                <span class="text-error" style="margin-left: 16px;font-size: x-large ;font-weight: bold">*</span>
            </div>

            <div class="span1">
            </div>
        </div>
        </br>

        <div class="row-fluid">
            <div class="span1">
            </div>
            <div class="span2">
                <h4>Version code</h4>
            </div>

            <div class="span6">
                 <input id='ver-code' name="ver_code" class="input-xlarge" type="text">
                 <span class="text-error" style="margin-left: 16px;font-size: x-large ;font-weight: bold">*</span>
            </div>

            <div class="span1">
            </div>
        </div>
        </br>


         <div class="row-fluid">
            <div class="span1">
            </div>
            <div class="span2">
                <h4>软件大小</h4>
            </div>

            <div class="span6">
                 <input id='apk_size' name="apk_size" class="input-xlarge" type="text" value="" />
                 <span id="apk_size_format" class="label label-warning">..M</span>
            </div>

            <div class="span1">
            </div>
        </div>
         </br>

        
       <div class="row-fluid">
            <div class="span1">
            </div>
            <div class="span2">
                <h4>Appstore URL(IOS专用)</h4>
            </div>

            <div class="span6">
                 <input id='ios-url' name="ios-url" class="input-xlarge" type="text" value="{{ios_url}}">
            </div>

            <div class="span1">
            </div>
        </div>
        <br>
        <!--<div id="PID-HIDE" class="row-fluid">
            <div class="span1">
            </div>
            <div class="span2">
                <h4>回流PID:</h4>
            </div>

            <div id="pid_box" class="span4" >
                <input name="pid[]" class="input-xlarge" type="text" value="" />
            </div>

            <div class="span3">
                <span id="add-pid" class="btn btn-success fileinput-button  btn">
                    <span>+ 添加pid</span>
                </span><span class="text-error" style="margin-left: 16px;font-size: x-large ;font-weight: bold">*</span>
            </div>
        </div>
        <br>-->

        <div class="row-fluid">
            <div class="span1">
            </div>
            <div class="span2">
                <h4>PID黑名单</h4>
            </div>

            <div id="black_pid_box" class="span4">
                <input name="black_pid[]" class="input-xlarge" type="text" value="" />
            </div>

            <div class="span3">
                <span id="add-black-pid" class="btn btn-success fileinput-button">
                    <span>+ 添加pid</span>
                </span>
            </div>
        </div>


        <div class="row-fluid">
            <div class="span1">
            </div>
            <div class="span2">
                <h4>星级打分</h4>
            </div>

            <div class="span6">
                <select name="score" id="score">
                    {% for score, show in scores %}
                    <option value="{{score}}">{{show}}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="row-fluid">
            <div class="span1">
            </div>
            <div class="span2">
                <h4>推荐类型</h4>
            </div>

            <div class="span6">
                 <select name="recommend_type" class="input-xlarge" id="recommend_type" >
                        <option value="">空</option>
                    {% for recommendtype in recommendtypes %}
                        <option value="{{ recommendtype.id }}">{{ recommendtype.name }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="row-fluid">
            <div class="span1">
            </div>
            <div class="span2">
                <h4>适配设备类型</h4>
            </div>

            <div class="span6">
                <select name="adaptive" class="input-xlarge" id="adaptive" >
                    <option value="0">Phone/Pad</option>
                    <option value="1">Phone</option>
                    <option value="2">Pad</option>
                </select>
            </div>
        </div>

        <hr>
        <div class="row-fluid">
            <div class="span1">

            </div>
            <div class="span2">
                <h4>选择截图类型</h4>
            </div>
            <div class="span6">

                <select id='select-img-type'>
                    <option value="0" selected="selected">横图</option>
                    <option value="1">竖图</option>
                </select>

                <span class="text-error" style="margin-left: 16px;font-size: x-small ;font-weight: bold">横图上传16:9的图片，竖图需要上传9:16，1M以内
      </span>


            </div>
        </div>
        <br>
        <div class="row-fluid" id="screen_div_1">
            <div class="span1">
            </div>

            <div class="span2">
                <h4>应用截图1</h4>
            </div>

            <div class="span6">

                <span id="screen_button" class="btn btn-success fileinput-button  btn-large ">
                     <span>+ 上传应用截图...</span>
                     <input id="screen-img-upload" type="file" name="files[]" multiple>
                </span>

               <div id="screen_success" class="alert alert-success" style="display: none;font-size: 20px;margin-top: 10px">
                   <button type="button" class="close" >&times;</button>
                   <img id='screen-content' src="" class="img-polaroid">
               </div>
               <div id="screen-progress" class="progress progress-success progress-striped  active" style="display: none">
                    <div class="bar"></div>
               </div>
               <input type='hidden' id='screen-input' name='screen-img' value="" height="100" width="100"/>
            </div>


        </div>
        <br>

        <div class="row-fluid"  id="screen_div_2">
            <div class="span1">
            </div>

            <div class="span2">
                <h4>应用截图2</h4>
            </div>

            <div class="span6">

                <span id="screen_button2" class="btn btn-success fileinput-button  btn-large ">
                        <span>+ 上传应用截图...</span>
                        <input id="screen-img-upload2" type="file" name="files[]" multiple>
                </span>

               <div id="screen_success2" class="alert alert-success" style="display: none;font-size: 20px;margin-top: 10px">
                   <button type="button" class="close">&times;</button>
                   <img id='screen-content2' src="" class="img-polaroid" >
               </div>
               <div id="screen-progress2" class="progress progress-success progress-striped  active" style="display: none">
                    <div class="bar"></div>
               </div>
               <input type='hidden' id='screen-input2' name='screen-img2' value=""/>
            </div>
        </div>
        <br>

        <div class="row-fluid"  id="screen_div_3">
            <div class="span1">
            </div>

            <div class="span2">
                <h4>应用截图3</h4>
            </div>

            <div class="span6">

                <span id="screen_button3" class="btn btn-success fileinput-button  btn-large ">
                        <span>+ 上传应用截图...</span>
                        <input id="screen-img-upload3" type="file" name="files[]" multiple>
                </span>

               <div id="screen_success3" class="alert alert-success" style="display: none;font-size: 20px;margin-top: 10px">
                   <button type="button" class="close">&times;</button>
                   <img id='screen-content3' src="" class="img-polaroid" >
               </div>
               <div id="screen-progress3" class="progress progress-success progress-striped  active" style="display: none">
                    <div class="bar"></div>
               </div>
               <input type='hidden' id='screen-input3' name='screen-img3' value=""/>
            </div>
        </div>
        <br>

        <div class="row-fluid"  id="screen_div_4">
            <div class="span1">
            </div>

            <div class="span2">
                <h4>应用截图4</h4>
            </div>

            <div class="span6">

                <span id="screen_button4" class="btn btn-success fileinput-button  btn-large ">
                        <span>+ 上传应用截图...</span>
                        <input id="screen-img-upload4" type="file" name="files[]" multiple>
                </span>

               <div id="screen_success4" class="alert alert-success" style="display: none;font-size: 20px;margin-top: 10px">
                   <button type="button" class="close">&times;</button>
                   <img id='screen-content4' src="" class="img-polaroid" >
               </div>

               <div id="screen-progress4" class="progress progress-success progress-striped  active" style="display: none">
                    <div class="bar"></div>
               </div>

               <input type='hidden' id='screen-input4' name='screen-img4' value=""/>
            </div>
        </div>

        <br>
        <div class="row-fluid"  id="screen_div_5">
            <div class="span1">
            </div>

            <div class="span2">
                <h4>应用截图5</h4>
            </div>

            <div class="span6">
                <span id="screen_button5" class="btn btn-success fileinput-button  btn-large ">
                    <span>+ 上传应用截图...</span>
                    <input id="screen-img-upload5" type="file" name="files[]" multiple>
                </span>

               <div id="screen_success5" class="alert alert-success" style="display: none;font-size: 20px;margin-top: 10px">
                   <button type="button" class="close">&times;</button>
                   <img id='screen-content5' src="" class="img-polaroid" >
               </div>
               <div id="screen-progress5" class="progress progress-success progress-striped  active" style="display: none">
                    <div class="bar"></div>
               </div>
               <input type='hidden' id='screen-input5' name='screen-img5' value=""/>
            </div>
        </div>
        <br>
        <div class="row-fluid"  id="screen_div_6">
            <div class="span1">
            </div>

            <div class="span2">
                <h4>应用截图6</h4>
            </div>

            <div class="span6">

                <span id="screen_button6" class="btn btn-success fileinput-button  btn-large ">
                        <span>+ 上传应用截图...</span>
                        <input id="screen-img-upload6" type="file" name="files[]" multiple>
                </span>

               <div id="screen_success6" class="alert alert-success" style="display: none;font-size: 20px;margin-top: 10px">
                   <button type="button" class="close">&times;</button>
                   <img id='screen-content6' src="" class="img-polaroid">
               </div>
               <div id="screen-progress6" class="progress progress-success progress-striped  active" style="display: none">
                    <div class="bar"></div>
               </div>
               <input type='hidden' id='screen-input6' name='screen-img6' value=""/>
            </div>
        </div>

        <hr>

        <div class="row-fluid">
            <div class="span1">
            </div>
            <div class="span2">
                <h4>游戏视频vid列表:</h4>
                <h5 style="color: red">需要删除的vid请留空</h5>
            </div>

            <div id="vid_box" class="span4">
                <input name="vids[]" class="input-xlarge" type="text" value="" />
            </div>

            <div class="span3">
                <span id="add-vid" class="btn btn-success fileinput-button">
                    <span>+ 添加vid</span>
                </span>
            </div>
        </div>

        <hr>

        <div class="row-fluid">
            <div class="span8">
            </div>
            <div class="span4">
                <img id="loader" style="display: none;width:56px" src="{{ STATIC_URL }}img/loading.gif" alt="loading "/>
                <input id="sub" type="submit" value="保存" class="btn btn-primary btn-large ">
            </div>
        </div>

    <!-- Modal -->
    <div id="formErrorModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h3 id="myModalLabel">提示(Esc关闭)</h3>
        </div>
        <div class="modal-body">
            <p class="text-error">提示消息</p>
        </div>
        <div class="modal-footer">
            <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
        </div>
    </div>
    </form>


    </div>

    <div  id="form_success"  style="display: none">
        <div id="floater" style="float:left; height:200px; margin-bottom:-120px;"></div>

        <div class="alert alert-success" style="width: 600px;margin: auto auto;clear:both; height:240px; position:relative;">
            <h1>Success！</h1>
            <p>保存应用成功<span style="margin: 10px"><a href="/app/add"> &gt;&gt;&gt;继续添加</a></span><span><a href="/app/list"> &gt;&gt;&gt;应用列表</a></span></p>
        </div>
    </div>


{% endblock %}

<!-- 添加自己的js文件-->
{% block js %}

    <script src="{{ STATIC_URL }}file_upload/js/vendor/jquery.ui.widget.js"></script>
    <script src="{{ STATIC_URL }}file_upload/js/jquery.iframe-transport.js"></script>
    <script src="{{ STATIC_URL }}file_upload/js/jquery.fileupload.js"></script>

    <!--<script src="{{ STATIC_URL }}raty/jquery.raty.min.js"></script>
    <script type="text/javascript">$('#star').raty({score: 3, path: "../static/img/"});</script>-->

<script type="text/javascript">
    $('#appname').tooltip({'trigger':'hover', 'title': '上传完成后自动生成软件名','placement':'right'});
    $('#package').tooltip({'trigger':'hover', 'title': '上传完成后自动生成包名','placement':'right'});
    $('.text-error').tooltip({'trigger':'hover', 'title': '必填','placement':'right'});
    $('#desc').tooltip({'trigger':'hover', 'title': '填写应用描述','placement':'right'});
    $('#ver-num').tooltip({'trigger':'hover', 'title': '上传完成后自动生成版本号','placement':'right'});
    $('#ver-code').tooltip({'trigger':'hover', 'title': '上传完成后自动生成version code','placement':'right'});
    $('#ios-url').tooltip({'trigger':'hover', 'title': '苹果 App store下载地址','placement':'right'});
    $('#add-pid').tooltip({'trigger':'hover', 'title': '点击添加pid','placement':'right'});
    $('#upload-apk-url').tooltip({'trigger':'hover', 'title': '上传成功后会自动生成下载链接','placement':'right'});
</script>


<script type="text/javascript">
    $(function () {

    $(".alert button").click(function(){
        var btn = $(this);
        $(btn).next().attr("src","");
        parent = $(btn).parent();
        //隐藏
        parent.hide();
        //设置hidden input的值
        if(parent.next().next()) parent.next().next().val("");
        //显示上传按钮
        $(parent.parent().children()[0]).show();

    });

    var url = '/app/img/upload';
    //初始化，主要是设置上传参数，以及事件处理方法(回调函数)

    $('#screen-img-upload').fileupload({
        autoUpload: true,//是否自动上传
        url: url,//上传地址
        dataType: 'json',
        acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
        maxFileSize: 1048576,


        add: function(e, data) {
                data.formData = {
                    'type': $('#select-img-type').val()
                };
                var uploadErrors = [];
                var acceptFileTypes = /^image\/(gif|jpe?g|png)$/i;
                if('type' in data.originalFiles[0] && !acceptFileTypes.test(data.originalFiles[0]['type'])) {
                    uploadErrors.push('上传图片格式错误!');
                }

                if('size' in data.originalFiles[0] && data.originalFiles[0]['size'] > 1048576) {
                    uploadErrors.push('上传图片需要小于1M!');
                }

                if(uploadErrors.length > 0) {
                    show_error_msg(uploadErrors.join("\n"));
                } else {
                    data.submit();
                }
        },

        done: function (e, data) {//设置文件上传完毕事件的回调函数

            if("e" in data.result && data.result["e"]["code"] < 0)
            {
                $("#screen_button").show();
                $("#screen-progress").hide();
                show_error_msg("upload error:" + data.result["e"]["code"] + ':'+data.result["e"]["desc"]);
                return;
            }

            $.each(data.result.files, function (index, file) {//
                $("#screen-content").attr("src",file.url);
                $("#screen-content").show();
                scoller_input = $("#screen-input")
                scoller_input.attr('value',file.url)
            });

            $("#screen-progress").hide();
            $("#screen_success").show();
        },

        progressall: function (e, data) {//设置上传进度事件的回调函数

            $("#screen_button").hide();
            $("#screen-progress").show();

            var progress = parseInt(data.loaded / data.total * 100, 10);
            $('#scoller-progress .bar').css(
                'width',
                progress + '%'
            );
        }

    });

    $('#screen-img-upload2').fileupload({
        autoUpload: true,//是否自动上传
        url: url,//上传地址
        dataType: 'json',
        acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
        maxFileSize: 1048576,


        add: function(e, data) {
                            data.formData = {
                    'type': $('#select-img-type').val()
                };
                var uploadErrors = [];
                var acceptFileTypes = /^image\/(gif|jpe?g|png)$/i;
                if('type' in data.originalFiles[0] && !acceptFileTypes.test(data.originalFiles[0]['type'])) {
                    uploadErrors.push('上传图片格式错误!');
                }

                if('size' in data.originalFiles[0] && data.originalFiles[0]['size'] > 1048576) {
                    uploadErrors.push('上传图片需要小于1M!');
                }

                if(uploadErrors.length > 0) {
                    show_error_msg(uploadErrors.join("\n"));
                } else {
                    data.submit();
                }
        },

        done: function (e, data) {//设置文件上传完毕事件的回调函数

            if("e" in data.result && data.result["e"]["code"] < 0)
            {
                $("#screen_button2").show();
                $("#screen-progress2").hide();
                show_error_msg("upload error:" + data.result["e"]["code"] + ':'+data.result["e"]["desc"]);
                return;
            }

            $.each(data.result.files, function (index, file) {//
                $("#screen-content2").attr("src",file.url);
                $("#screen-content2").show();
                scoller_input = $("#screen-input2")
                scoller_input.attr('value',file.url)
            });

            $("#screen-progress2").hide();
            $("#screen_success2").show();
        },

        progressall: function (e, data) {//设置上传进度事件的回调函数

            $("#screen_button2").hide();
            $("#screen-progress2").show();

            var progress = parseInt(data.loaded / data.total * 100, 10);
            $('#scoller-progress2 .bar').css(
                'width',
                progress + '%'
            );
        }

    });


    $('#screen-img-upload3').fileupload({
        autoUpload: true,//是否自动上传
        url: url,//上传地址
        dataType: 'json',
        acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
        maxFileSize: 1048576,


        add: function(e, data) {
                data.formData = {
                    'type': $('#select-img-type').val()
                };
                var uploadErrors = [];
                var acceptFileTypes = /^image\/(gif|jpe?g|png)$/i;
                if('type' in data.originalFiles[0] && !acceptFileTypes.test(data.originalFiles[0]['type'])) {
                    uploadErrors.push('上传图片格式错误!');
                }

                if('size' in data.originalFiles[0] && data.originalFiles[0]['size'] > 1048576) {
                    uploadErrors.push('上传图片需要小于1M!');
                }

                if(uploadErrors.length > 0) {
                    show_error_msg(uploadErrors.join("\n"));
                } else {
                    data.submit();
                }
        },

        done: function (e, data) {//设置文件上传完毕事件的回调函数

            if("e" in data.result && data.result["e"]["code"] < 0)
            {
                $("#screen_button3").show();
                $("#screen-progress3").hide();
                show_error_msg("upload error:" + data.result["e"]["code"] + ':'+data.result["e"]["desc"]);
                return;
            }

            $.each(data.result.files, function (index, file) {//
                $("#screen-content3").attr("src",file.url);
                $("#screen-content3").show();
                scoller_input = $("#screen-input3")
                scoller_input.attr('value',file.url)
            });

            $("#screen-progress3").hide();
            $("#screen_success3").show();
        },

        progressall: function (e, data) {//设置上传进度事件的回调函数

            $("#screen_button3").hide();
            $("#screen-progress3").show();

            var progress = parseInt(data.loaded / data.total * 100, 10);
            $('#scoller-progress3 .bar').css(
                'width',
                progress + '%'
            );
        }

    });

    $('#screen-img-upload4').fileupload({
        autoUpload: true,//是否自动上传
        url: url,//上传地址
        dataType: 'json',
        acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
        maxFileSize: 1048576,


        add: function(e, data) {
                data.formData = {
                    'type': $('#select-img-type').val()
                };
                var uploadErrors = [];
                var acceptFileTypes = /^image\/(gif|jpe?g|png)$/i;
                if('type' in data.originalFiles[0] && !acceptFileTypes.test(data.originalFiles[0]['type'])) {
                    uploadErrors.push('上传图片格式错误!');
                }

                if('size' in data.originalFiles[0] && data.originalFiles[0]['size'] > 1048576) {
                    uploadErrors.push('上传图片需要小于1M!');
                }

                if(uploadErrors.length > 0) {
                    show_error_msg(uploadErrors.join("\n"));
                } else {
                    data.submit();
                }
        },

        done: function (e, data) {//设置文件上传完毕事件的回调函数

            if("e" in data.result && data.result["e"]["code"] < 0)
            {
                $("#screen_button4").show();
                $("#screen-progress4").hide();
                show_error_msg("upload error:" + data.result["e"]["code"] + ':'+data.result["e"]["desc"]);
                return;
            }

            $.each(data.result.files, function (index, file) {//
                $("#screen-content4").attr("src",file.url);
                $("#screen-content4").show();
                scoller_input = $("#screen-input4")
                scoller_input.attr('value',file.url)
            });

            $("#screen-progress4").hide();
            $("#screen_success4").show();
        },

        progressall: function (e, data) {//设置上传进度事件的回调函数

            $("#screen_button4").hide();
            $("#screen-progress4").show();

            var progress = parseInt(data.loaded / data.total * 100, 10);
            $('#scoller-progress4 .bar').css(
                'width',
                progress + '%'
            );
        }

    });

    $('#screen-img-upload5').fileupload({
        autoUpload: true,//是否自动上传
        url: url,//上传地址
        dataType: 'json',
        acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
        maxFileSize: 1048576,


        add: function(e, data) {
                data.formData = {
                    'type': $('#select-img-type').val()
                };
                var uploadErrors = [];
                var acceptFileTypes = /^image\/(gif|jpe?g|png)$/i;
                if('type' in data.originalFiles[0] && !acceptFileTypes.test(data.originalFiles[0]['type'])) {
                    uploadErrors.push('上传图片格式错误!');
                }

                if('size' in data.originalFiles[0] && data.originalFiles[0]['size'] > 1048576) {
                    uploadErrors.push('上传图片需要小于1M!');
                }

                if(uploadErrors.length > 0) {
                    show_error_msg(uploadErrors.join("\n"));
                } else {
                    data.submit();
                }
        },

        done: function (e, data) {//设置文件上传完毕事件的回调函数

            if("e" in data.result && data.result["e"]["code"] < 0)
            {
                $("#screen_button5").show();
                $("#screen-progress5").hide();
                show_error_msg("upload error:" + data.result["e"]["code"] + ':'+data.result["e"]["desc"]);
                return;
            }

            $.each(data.result.files, function (index, file) {//
                $("#screen-content5").attr("src",file.url);
                $("#screen-content5").show();
                scoller_input = $("#screen-input5")
                scoller_input.attr('value',file.url)
            });

            $("#screen-progress5").hide();
            $("#screen_success5").show();
        },

        progressall: function (e, data) {//设置上传进度事件的回调函数

            $("#screen_button5").hide();
            $("#screen-progress5").show();

            var progress = parseInt(data.loaded / data.total * 100, 10);
            $('#scoller-progress5 .bar').css(
                'width',
                progress + '%'
            );
        }

    });

    $('#screen-img-upload6').fileupload({
        autoUpload: true,//是否自动上传
        url: url,//上传地址
        dataType: 'json',
        acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
        maxFileSize: 1048576,


        add: function(e, data) {
                data.formData = {
                    'type': $('#select-img-type').val()
                };
                var uploadErrors = [];
                var acceptFileTypes = /^image\/(gif|jpe?g|png)$/i;
                if('type' in data.originalFiles[0] && !acceptFileTypes.test(data.originalFiles[0]['type'])) {
                    uploadErrors.push('上传图片格式错误!');
                }

                if('size' in data.originalFiles[0] && data.originalFiles[0]['size'] > 1048576) {
                    uploadErrors.push('上传图片需要小于1M!');
                }

                if(uploadErrors.length > 0) {
                    show_error_msg(uploadErrors.join("\n"));
                } else {
                    data.submit();
                }
        },

        done: function (e, data) {//设置文件上传完毕事件的回调函数

            if("e" in data.result && data.result["e"]["code"] < 0)
            {
                $("#screen_button6").show();
                $("#screen-progress6").hide();
                show_error_msg("upload error:" + data.result["e"]["code"] + ':'+data.result["e"]["desc"]);
                return;
            }

            $.each(data.result.files, function (index, file) {//
                $("#screen-content6").attr("src",file.url);
                $("#screen-content6").show();
                scoller_input = $("#screen-input6")
                scoller_input.attr('value',file.url)
            });

            $("#screen-progress6").hide();
            $("#screen_success6").show();
        },

        progressall: function (e, data) {//设置上传进度事件的回调函数

            $("#screen_button6").hide();
            $("#screen-progress6").show();

            var progress = parseInt(data.loaded / data.total * 100, 10);
            $('#scoller-progress6 .bar').css(
                'width',
                progress + '%'
            );
        }

    });


    $('#file-scoller-img-upload').fileupload({
        autoUpload: true,//是否自动上传
        url: url,//上传地址
        dataType: 'json',
        acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
        maxFileSize: 1048576,


        add: function(e, data) {
                var uploadErrors = [];
                var acceptFileTypes = /^image\/(gif|jpe?g|png)$/i;
                var _URL = window.URL || window.webkitURL;
                img = new Image();
                img.src = _URL.createObjectURL(data.originalFiles[0]);
                if('type' in data.originalFiles[0] && !acceptFileTypes.test(data.originalFiles[0]['type'])) {
                    uploadErrors.push('上传图片格式错误!');
                }

                if('size' in data.originalFiles[0] && data.originalFiles[0]['size'] > 1048576) {
                    uploadErrors.push('上传图片需要小于1M!');
                }
                img.onload = function() {
                    if (img.width != 800 || img.height != 380) {
                        uploadErrors.push('上传图片尺寸错误。');
                    }
                    if(uploadErrors.length > 0) {
                        show_error_msg(uploadErrors.join("\n"));
                    } else {
                        data.submit();
                    }
                }
        },
        
        done: function (e, data) {//设置文件上传完毕事件的回调函数

            if("e" in data.result && data.result["e"]["code"] < 0)
            {
                $("#img_file_button").show();
                $("#scoller-progress").hide();
                show_error_msg("upload error:" + data.result["e"]["code"] + ':'+data.result["e"]["desc"]);
                return;
            }
            
            $.each(data.result.files, function (index, file) {//
                $("#scoller-img-content").attr("src",file.url);
                $("#scoller-img-content").show();
                scoller_input = $("#scoller-img-input")
                scoller_input.attr('value',file.url)
            });

            $("#scoller-progress").hide();
            $("#img_file_success").show();
        },

        progressall: function (e, data) {//设置上传进度事件的回调函数

            $("#img_file_button").hide();
            $("#scoller-progress").show();

            var progress = parseInt(data.loaded / data.total * 100, 10);
            $('#scoller-progress .bar').css(
                'width',
                progress + '%'
            );
        }

    });
    $('#file2-scoller-img-upload').fileupload({
        autoUpload: true,//是否自动上传
        url: url,//上传地址
        dataType: 'json',
        acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
        maxFileSize: 1048576,


        add: function(e, data) {
                var uploadErrors = [];
                var acceptFileTypes = /^image\/(gif|jpe?g|png)$/i;
                var _URL = window.URL || window.webkitURL;
                img = new Image();
                img.src = _URL.createObjectURL(data.originalFiles[0]);
                if('type' in data.originalFiles[0] && !acceptFileTypes.test(data.originalFiles[0]['type'])) {
                    uploadErrors.push('上传图片格式错误!');
                }

                if('size' in data.originalFiles[0] && data.originalFiles[0]['size'] > 1048576) {
                    uploadErrors.push('上传图片需要小于1M!');
                }
                img.onload = function() {
                    if (img.width != 800 || img.height != 270) {
                        uploadErrors.push('上传图片尺寸错误。');
                    }
                    if(uploadErrors.length > 0) {
                        show_error_msg(uploadErrors.join("\n"));
                    } else {
                        data.submit();
                    }
                }
        },

        done: function (e, data) {//设置文件上传完毕事件的回调函数

            if("e" in data.result && data.result["e"]["code"] < 0)
            {
                $("#img2_file_button").show();
                $("#scoller2-progress").hide();
                show_error_msg("upload error:" + data.result["e"]["code"] + ':'+data.result["e"]["desc"]);
                return;
            }

            $.each(data.result.files, function (index, file) {//
                $("#scoller2-img-content").attr("src",file.url);
                $("#scoller2-img-content").show();
                scoller_input = $("#scoller2-img-input")
                scoller_input.attr('value',file.url)
            });

            $("#scoller2-progress").hide();
            $("#img2_file_success").show();
        },

        progressall: function (e, data) {//设置上传进度事件的回调函数

            $("#img2_file_button").hide();
            $("#scoller2-progress").show();

            var progress = parseInt(data.loaded / data.total * 100, 10);
            $('#scoller2-progress .bar').css(
                'width',
                progress + '%'
            );
        }

    });

    $('#file-logo-img-upload').fileupload({
        autoUpload: true,//是否自动上传
        url: url,//上传地址
        dataType: 'json',
        acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
        maxFileSize: 1048576,

        add: function(e, data) {
                var uploadErrors = [];
                var acceptFileTypes = /^image\/(gif|jpe?g|png)$/i;
                if('type' in data.originalFiles[0] && !acceptFileTypes.test(data.originalFiles[0]['type'])) {
                    uploadErrors.push('上传图片格式错误!');
                }

                if('size' in data.originalFiles[0] && data.originalFiles[0]['size'] > 1048576) {
                    uploadErrors.push('上传图片需要小于1M!');
                }
                
                if(uploadErrors.length > 0) {
                    show_error_msg(uploadErrors.join("\n"));
                } else {
                    data.submit();
                }
        },

        done: function (e, data) {//设置文件上传完毕事件的回调函数

            if("e" in data.result && data.result["e"]["code"] < 0)
            {
                $("#icon_file_button").show();
                $("#logo-progress").hide();
                show_error_msg("upload error:" + data.result["e"]["code"] + ':'+data.result["e"]["desc"]);
                return;
            }
            
            $.each(data.result.files, function (index, file) {//
                $("#logo-img-content").attr("src",file.url);
                $("#logo-img-content").show()
                form = $("#app-info")
                logo_input = $("#logo-img-input")
                logo_input.attr('value',file.url)
                form.append(logo_input)
            });

            $("#logo-progress").hide();
            $("#icon_file_success").show();
        },
        progressall: function (e, data) {//设置上传进度事件的回调函数

            $("#icon_file_button").hide();
            $("#logo-progress").show();

            var progress = parseInt(data.loaded / data.total * 100, 10);
            $('#logo-progress .bar').css(
                'width',
                progress + '%'
            );
        },
        fail : function (e,data) {
            $("#icon_file_button").show();
            $("#logo-progress").hide();
            show_error_msg("上传失败!");
        }

    }).prop('disabled', !$.support.fileInput)
    .parent().addClass($.support.fileInput ? undefined : 'disabled');


    $('#file-apk-upload').fileupload({
        autoUpload: true,//是否自动上传
        url: '/app/apk/upload',//上传地址
        dataType: 'json',
        acceptFileTypes: /(\.|\/)(apk)$/i,


        add: function(e, data) {

            if('size' in data.originalFiles[0] ){
                var size = data.originalFiles[0]['size'];
                $("#apk_size").val(size);
                var format_size = size/1024.0/1024.0;
                format_size = format_size.toFixed(2);
                $("#apk_size_format").html(format_size+"M");
            }
            data.submit();
        },

        done: function (e, data) {//设置文件上传完毕事件的回调函数

            if("e" in data.result && data.result["e"]["code"] < 0)
            {
                $("#img_file_button").show();
                $("#scoller-progress").hide();
                show_error_msg(data.result["e"]["desc"]);
                return;
            }
            
            $.each(data.result.files, function (index, file) {//
                $("#upload-apk-url").val(file.url);
                $("#upload-apk-source-url").val(file.source);
                $("#ver-num").val(file.apk_info.version);
                $("#package").val(file.apk_info.pkg);
                $("#appname").val(file.apk_info.app_name);
                $("#ver-code").val(file.apk_info.version_code);
                $("#activity").val(file.apk_info.activity);
                $("#md5-input").val(file.md5);
                $("#md5-show").text(file.md5);
            });

            $("#apk-progress").hide();
            $("#upload_file_success").show();
        },
        progressall: function (e, data) {//设置上传进度事件的回调函数
            $("#upload_file_button").hide();
            $("#apk-progress").show();

            var progress = parseInt(data.loaded / data.total * 100, 10);
            $('#apk-progress .bar').css(
                'width',
                progress + '%'
            );
        },
        fail:function (e, data){
            show_error_msg("上传文件失败");
            $("#upload_file_button").show();
            $("#apk-progress").hide();
            
            $('#apk-progress .bar').css(
                'width',
                0 + '%'
            );
        }
    });

});
</script>

<script type="text/javascript">

  function show_error_msg(msg){

      $("#formErrorModal .modal-body p").text(msg);
      $("#formErrorModal").modal();

  }

  $("#app-info").submit(function(event){

      //检查是否是4-6张截图
      var screnn_shots = [];

      screnn_shots.push($('#screen-input').val());

      screnn_shots.push($('#screen-input2').val());

      screnn_shots.push($('#screen-input3').val());

      screnn_shots.push($('#screen-input4').val());

      screnn_shots.push($('#screen-input5').val());

      screnn_shots.push($('#screen-input6').val());

      var screen_count = 0;

      for(i=0;i<screnn_shots.length;i++){
          if (screnn_shots[i]) screen_count ++;

      }


      if (screen_count < 4){
          show_error_msg('请至少上传4张截图');
          return false;
      }

        if($("#upload-apk-url").val()==''){
            show_error_msg('请上传Apk文件');
            $("#upload-apk-url").focus();
            return false;
        }

        if($("#logo-img-input").val()==''){
            show_error_msg('请上传应用Logo');
            $("#logo-img-input").focus();
            return false;
        }


      if($("#appname").val()==''){
          show_error_msg('请填写应用名称');
          $("#appname").focus();
          return false;
      }
      if($("#upload-apk-url").val()==''){
          show_error_msg('请填写下载地址');
          $("#upload-apk-url").focus();
          return false;
      }
      if($("#package").val()==''){
          show_error_msg('请填写包名');
          $("#package").focus();
          return false;
      }
      if($("#activity").val()==''){
          show_error_msg('请填写Activity');
          $("#activity").focus();
          return false;
      }
      if($("#ver-num").val()==''){
          show_error_msg('请填写版本号');
          $("#ver-num").focus();
          return false;
      }
      if($("#ver-code").val()==''){
          show_error_msg('请上传应用Logo');
          $("#ver-code").focus();
          return false;
      }

      if($("#desc").val()==''){
          show_error_msg('请填写简介');
          return false;
      }

      if($("#short-desc").val()==''){
          show_error_msg('请填写短描述');
          return false;
      }

      if($("#game_categories").val()==''){
          show_error_msg('请选择游戏类型');
          return false;
      }

        event.preventDefault();

        $("#loader").show();
        $("#sub").attr("class","btn btn-primary disabled btn-large ");

        var group = $('input[name="pid[]"]');
        var pids = [];
        if (group.length >= 1){
            group.each( function() {
                pids.push($(this).val());
            });
        }
        pids = pids.join(";");

        var black_group = $('input[name="black_pid[]"]');
        console.log(black_group)
        var black_pids = [];
        if (black_group.length >= 1){
            black_group.each( function() {
                black_pids.push($(this).val());
            });
        }
        console.log(black_pids)
        black_pids = black_pids.join(";");
        console.log(black_pids)

        var vid_group = $('input[name="vids[]"]');
        console.log(vid_group)
        var tmp = {};
        var vids = [];
        if (vid_group.length >= 1){
            vid_group.each( function() {
                if ($(this).val() != '' && tmp[$(this).val()] != true){
                    vids.push($(this).val());
                    tmp[$(this).val()] = true;
                }
            });
        }
        vids = vids.join(';');

        //<input type="radio" id="horizontal" name="screen_shot_type" value="0" checked/> 横图
        //<input type="radio" id="vertical"
        //console.log(typeof $('#vertical').val());
        $.ajax({
             type:"POST",
             url:"/app/add",
             data: {
                 md5:$('#md5-input').val(),
                 activity:$('#activity').val(),
                 ver_num:$("#ver-num").val(),
                 pkg:$("#package").val(),
                 appname:$("#appname").val(),
                 ver_code:$("#ver-code").val(),
                 apk_url:$("#upload-apk-url").val(),
                 apk_source_url:$("#upload-apk-source-url").val(),
                 apk_status:$("#app-status").val(),
                 desc:$("#desc").val(),
                 logo:$('#logo-img-input').val(),
                 scoller:$('#scoller-img-input').val(),
                 scoller2:$('#scoller2-img-input').val(),
                 pids:pids,
                 black_pids:black_pids,
                 apk_size : $("#apk_size").val(),
                 screen_shot1: $('#screen-input').val(),
                 screen_shot2: $('#screen-input2').val(),
                 screen_shot3: $('#screen-input3').val(),
                 screen_shot4: $('#screen-input4').val(),
                 screen_shot5: $('#screen-input5').val(),
                 screen_shot6: $('#screen-input6').val(),
                 screen_shot_type:$('#select-img-type').val(),
                 app_status:$('#select-status').val(),
                 short_desc:$('#short-desc').val(),
                 game_categories:$('#game_categories').val(),
                 score:$('#score').val(),
                 recommend_type:$('#recommend_type').val(),
                 adaptive:$('#adaptive').val(),
                 vids:vids,
                 force_update: $('#force-update').val(),
                 update_info: $('#update-info').val()
             },
             success: function(data){

                 $("#form_div").hide();
                 $("#form_success").show();
                 $("#ver-num").val('');
                 $("#package").val('');
                 $("#appname").val('');
                 $("#ver-code").val('');
                 $("#upload-apk-url").val('');
                 $("#app-status").val('');
                 $("#desc").val('');
                 $("#logo-img-content").hide();
                 $("#scoller-img-content").hide();
                 $("#scoller2-img-content").hide();
                 $('#logo-progress .bar').css(
                    'width',
                    0 + '%');
                 $('#scoller-progress .bar').css(
                    'width',
                    0 + '%');
                 $('#apk-progress .bar').css(
                    'width',
                    0 + '%');
             },
             error: function(jqXHR,  textStatus,  errorThrown ){
                $("#loader").hide();
                 $("#sub").attr("class","btn btn-primary btn-large ");
                 show_error_msg("保存失败，请重试！");
             }

        });
        return false;
   });

    $("#add-pid").click(function(){
        var input_pid=$('<input name="pid[]" class="input-xlarge" type="text" value="" />');
        $("#pid_box").append(input_pid);
    });
    $("#add-black-pid").click(function(){
        var input_pid=$('<input name="black_pid[]" class="input-xlarge" type="text" value="" />');
        $("#black_pid_box").append(input_pid);
    });
    $("#add-vid").click(function(){
        var input_vid=$('<input name="vids[]" class="input-xlarge" type="text" value="" />');
        $("#vid_box").append(input_vid);
    });

</script>

{% endblock %}



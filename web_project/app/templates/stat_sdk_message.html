{% extends "base.html" %}

{% block link %}
    <script type="text/javascript" charset="utf-8">
        line_basic_time({{ categories|safe }},'{{ title|safe }}',{{ names|safe }},{{ datas|safe }},'{{ realtime_container|safe }}');
    </script>
    <style type="text/css" mce_bogus="1">
        table th
        {
            white-space: nowrap;
        }
        table td
        {
            white-space: nowrap;
        }
        .custom-combobox {
            position: relative;
            display: inline-block;
        }
        .custom-combobox-toggle {
            position: absolute;
            top: 0;
            bottom: 0;
            margin-left: -1px;
            padding: 0;
            /* support: IE7 */
            *height: 1.7em;
            *top: 0.1em;
        }
        .custom-combobox-input {
            margin: 0;
            padding: 0.3em;
        }

    </style>
    <link href="{{ STATIC_URL }}css/page.css" rel="stylesheet">
{% endblock %}

{% load keyvalue %}
{% block content %}

    <form role="form" action="/stat/app/sdk_message" id='index_query'>
        <input type="hidden" name='stat_type' id='stat_type' value="{{ stat_type }}"/>
        <div class="row-fluid">
            <div class="span2" style="width: 180px;margin-left: 0px;">
                <div class="time">
                    <div class="controls input-append date form_date" data-date="" data-date-format="yyyy-mm-dd" data-link-field="dtp_input2" data-link-format="yyyy-mm-dd">
                        <span class="add-on">时间：</span>
                        <span class="add-on"><i class="icon-th"></i></span>
                        <input size="10" type="text" value="{{ date_from }}" readonly id='date_from' name='date_from'>
                    </div>
                </div>
            </div>

            <div class="span2" style="width: 130px;margin-left: 10px;">
                <div class="input-prepend">
                    <span class="add-on">小时：</span>
                    <select id='hour_select' class="span8" name='hour_select'>
                        {% for ele in hours %}
                            {% if ele.selected %}
                                <option value="{{ ele.value }}" selected='{{ ele.selected }}'>{{ ele.name }}</option>
                            {% else %}
                                <option value="{{ ele.value }}">{{ ele.name }}</option>
                            {% endif %}

                        {% endfor %}

                    </select>
                </div>
            </div>

            <div class="span4">
                <button type="button" class="btn btn-success" id='query_btn' time_type='0'>查询</button>
            </div>
        </div>

        <table class="table table-condensed table-hover">
            <tr>
                <td colspan="4">
                    {% for ele in select_stat_type_list %}
                    <label class="radio inline">
                        <input stat_type='{{ ele.id }}' id='query_btn_{{ ele.id }}' type="radio" {{ ele.checkon }}>{{ ele.name }}
                    </label>
                    {% endfor %}
                </td>
            </tr>
        </table>
    </form>

    <div class="row-fluid" id="{{ realtime_container }}"><!-- 各游戏点击下载量不同时段分布图--></div>
    <div style="overflow: auto; width: 100%;">
        <table class="table table-hover table-bordered" id="realtime_stat">
            <button type="button" class="btn btn-success" onclick="getCSVData('realtime_stat');">下载至Excel</button>
            <thead>
            <tr>
                <th colspan="{{ col_span }}" style="background-color: #e2edfb;">各时段分布{{ stat_download_type }}</th>
            </tr>
            <tr>
                <th>时段</th>
                {% for ele in cl_time_list %}
                    <th>{{ ele }}</th>
                {% endfor %}
            </tr>
            </thead>
            <tbody>
            {% for item in lines %}
                <tr>
                    <td>{{ item.name }}</td>
                {% for ele in item.xaxis %}
                    <td>{{ ele }}</td>
                {% endfor %}
                </tr>
            {% endfor %}
            </tbody>
        </table>
        {{ pages|safe }}
    </div>
    {#    为下载表格专门提供的form#}
    <form action="/stat/app/getcsv" method ="post" name="formCSV" accept-charset="utf8" >
        <input type="hidden" name="csv_text" id="csv_text">
    </form>
{% endblock %}
{% block js %}
    <script type="text/javascript">

        $('#query_btn,#query_btn_0,#query_btn_1').click(function (e) {

            if ($(this).attr('id') != 'query_btn'){
                $('#stat_type').val($(this).attr('stat_type'));
            }

            $('#index_query').submit()
        });

    </script>
{% endblock %}
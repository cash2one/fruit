{% extends "base.html" %}
{% block link %}
    <style type="text/css" mce_bogus="1">
        .custom-combobox {
            position: relative;
            display: inline-block;
        }
        .custom-combobox-toggle {
            position: absolute;
            top: 0;
            bottom: 0;
            margin-left: -1px;
            padding: 0;
            /* support: IE7 */
            *height: 1.7em;
            *top: 0.1em;
        }
        .custom-combobox-input {
            margin: 0;
            padding: 0.3em;
        }
    </style>
    <link href="{{ STATIC_URL }}css/page.css" rel="stylesheet">
{% endblock %}

{% load keyvalue %}
{% block content %}


    <form role="form" action="/stat/app/detail" id='index_query'>
            <input type="hidden" name='time_type' id='time_type' value="{{ time_type }}"/>

        <div class="row-fluid">
                <div class="span4" style="width: 350px;margin-left: 0px;">
                    <div class="time">
                        <div class="controls input-append date form_date" data-date="" data-date-format="yyyy-mm-dd" data-link-field="dtp_input2" data-link-format="yyyy-mm-dd">
                            <span class="add-on">从：</span>
                            <span class="add-on"><i class="icon-th"></i></span>
                            <input size="10" type="text" value="{{ date_from }}" readonly id='date_from' name='date_from'>
                        </div>
                        <div class="controls input-append date form_date" data-date="" data-date-format="yyyy-mm-dd" data-link-field="dtp_input2" data-link-format="yyyy-mm-dd">
                            <span class="add-on">到：</span>
                            <span class="add-on"><i class="icon-th"></i></span>
                            <input size="10" type="text" value="{{ date_to }}" readonly id='date_to' name='date_to'>
                        </div>
                    </div>
                </div>
                <div class="span2" style="margin-left: 3px;">
                    <div class="input-prepend">
                        <span class="add-on">产品：</span>
                        <select id='product_select' class="span8" name='product_select'>
                            {% for ele in products %}
                                {% if ele.selected %}
                                    <option value="{{ ele.value }}" selected='{{ ele.selected }}'>{{ ele.name }}</option>
                                {% else %}
                                    <option value="{{ ele.value }}">{{ ele.name }}</option>
                                {% endif %}

                            {% endfor %}

                        </select>
                    </div>
                </div>
                <div class="span2" style="margin-left: 3px;">
                    <div class="input-prepend">
                        <span class="add-on">平台：</span>
                        <select id='platform_select' class="span8" name='platform_select'>
                            <option value="0">全部</option>
                            {% for ele in platform %}
                                {% if ele.selected %}
                                    <option value="{{ ele.value }}" selected='{{ ele.selected }}'>{{ ele.name }}</option>
                                {% else %}
                                    <option value="{{ ele.value }}">{{ ele.name }}</option>
                                {% endif %}
                            {% endfor %}

                        </select>
                    </div>
                </div>

                <div class="span2" style="margin-left: 3px;">
                    <div class="input-prepend">
                        <span class="add-on">终端：</span>
                        <select id='device_select' class="span8" name='device_select'>
                            {% for ele in devices %}
                                {% if ele.selected %}
                                    <option value="{{ ele.value }}" selected='{{ ele.selected }}'>{{ ele.name }}</option>
                                {% else %}
                                    <option value="{{ ele.value }}">{{ ele.name }}</option>
                                {% endif %}
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="span2" style="margin-left: 3px;">
                    <div class="input-prepend">
                        <span class="add-on">来源：</span>
                        <select id='source_select' class="span8" name='source_select'>
                            {% for ele in source %}
                                {% if ele.selected %}
                                    <option value="{{ ele.value }}" selected='{{ ele.selected }}'>{{ ele.name }}</option>
                                {% else %}
                                    <option value="{{ ele.value }}">{{ ele.name }}</option>
                                {% endif %}
                            {% endfor %}

                        </select>
                    </div>
                </div>
            <div>
                <button type="button" class="btn btn-success" id='query_btn' time_type='0'>查询</button>
            </div>
        </div>

        <div class="row-fluid">
            <div class="span2">
                <div class="input-prepend">
                    <span class="add-on">游戏类型：</span>
                    <select id='cat_select' class="span7" name='cat_select' onchange="get_app_list(this.value)" style="width: 92px;">
                        {% for ele in cats %}
                            {% if ele.selected %}
                                <option value="{{ ele.value }}" selected='{{ ele.selected }}'>{{ ele.name }}</option>
                            {% else %}
                                <option value="{{ ele.value }}">{{ ele.name }}</option>
                            {% endif %}

                        {% endfor %}

                    </select>
                </div>
            </div>
            <div class="span4">
                <div class="input-prepend">
                    <span class="add-on">游戏名称：</span>
                    <select id='app_select' name='app_select'>
                        <option value="0">全部</option>
                        {% for ele in app_list %}
                            {% if ele.selected %}
                                <option value="{{ ele.id }}" selected='{{ ele.selected }}'>{{ ele.appname }}</option>
                            {% else %}
                                <option value="{{ ele.id }}">{{ ele.appname }}</option>
                            {% endif %}

                        {% endfor %}

                    </select>
                </div>
            </div>

        </div>


    </form>

    <div class="row-fluid" id='app_download_info'>
        <!-- 应用明细统计图-->
        <script type="text/javascript" charset="utf-8">
            line_basic_b({{ categories_0|safe }},'{{ title_0|safe }}',{{ names_0|safe }},{{ datas_0|safe }},{{ value_suffixs|safe }},'app_download_info');
        </script>
    </div>
    <div class="row-fluid">
        <div class="span12">
            <table class="table table-hover table-bordered" id="game_detal">
{#              <h4>报表列表</h4>#}
              <button type="button" class="btn btn-success" onclick="getCSVData('game_detal');">下载至Excel</button>
              <thead>
              <tr>
                  <th colspan="5" style="background-color: #e2edfb;">游戏详情统计明细</th>
              </tr>
                <tr>
                    <th>日期</th>
                    {% for ele in tab_names_0 %}
                        <th>{{ ele }}</th>
                    {% endfor %}
                </tr>
              </thead>
              <tbody>
              {% for items in items_list_0 %}
                  <tr>
                      {% for item in items %}
                          <td>{{ item }}</td>
                      {% endfor %}
                  </tr>
              {% endfor %}
              </tbody>
            </table>
        </div>
    </div>

    <div class="row-fluid" id='column_basic'>
        <!-- 不同来源分布图-->
        <script type="text/javascript" charset="utf-8">
            Column_basic({{ categories_1|safe }},'{{ title_1|safe }}',{{ names_1|safe }},{{ datas_1|safe }},'column_basic');
        </script>
    </div>
    <div class="row-fluid">
        <div class="span12">
            <table class="table table-hover table-bordered" id="source_detail">
{#                <h4>报表列表</h4>#}
                <button type="button" class="btn btn-success" onclick="getCSVData('source_detail');">下载至Excel</button>
                <thead>
                <tr>
                    <th colspan="3" style="background-color: #e2edfb;">游戏来源详情明细</th>
                </tr>
                <tr>
                    <th>来源</th>
                    {% for ele in tab_names_1 %}
                        <th>{{ ele }}</th>
                    {% endfor %}
                </tr>
                </thead>
                <tbody>
                {% for items in items_list_1 %}
                    <tr>
                        {% for item in items %}
                            <td>{{ item }}</td>
                        {% endfor %}
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {#    为下载表格专门提供的form#}
    <form action="/stat/app/getcsv" method ="post" name="formCSV" accept-charset="utf8" >
        <input type="hidden" name="csv_text" id="csv_text">
    </form>
{% endblock %}
{% block js %}
{#    <script src="http://code.highcharts.com/modules/exporting.js"></script>#}
<script type="text/javascript">

    $('#query_btn,#query_btn_day,#query_btn_week,#query_btn_month').click(function (e) {

        if ($(this).attr('id') != 'query_btn')
            $('#time_type').val($(this).attr('time_type'));
        $('#index_query').submit()
    });

    function get_app_list(req){
        $.ajax({
            type: "GET",
            url: "/stat/app/applist",
            async:true,
            data:{cat_id:req},
            dataType: "json",
            success: function(msg){
                if(msg['app_list'] != ''){
                    $("#app_select").html(msg["app_list"]);

                }else{
                    $("#app_select").empty();
                }

            }
        });
    }

    magicmenu('app_select')
    </script>
{% endblock %}
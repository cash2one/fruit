<div class="modal fade" id="itemModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="exampleModalLabel">新增抽屉内容</h4>
      </div>
      <div class="modal-body">
        <form id="form_add_box" method="post" action="/content/box/child/create">

            <input type="text" id="box_id" name="box_id" value="{{ box_id }}" style="display: none;"/>

          <div class="form-group form-inline">
            <label for="recipient-name" class="control-label">输入商品名称:</label>
            <input type="text" id="key_name"/>
          </div>
{#          <div class="form-group form-inline">#}
{#            <label for="recipient-name" class="control-label">内容:</label>#}
{#            <select class="form-control" id="select_item" name="select_item" placeholder="">#}
{#                            {% for item in items %}#}
{#                                <option value="{{ item.id }}">{{ item.title}}</option>#}
{#                            {% endfor %}#}
{#            </select>#}
{#          </div>#}

        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
        <button id="btn_create" type="button" class="btn btn-primary">创建</button>
      </div>
    </div>
  </div>
  <script type="text/javascript">

    // prepare the form when the DOM is ready
    $(document).ready(function() {
        var options = {
            //target:        '#output1',   // target element(s) to be updated with server response
            beforeSubmit:  showRequest,  // pre-submit callback
            success:       showResponse  // post-submit callback
        };

        $('#form_add_box').ajaxForm(options);

        $('#btn_create').click(function(){
            $('#form_add_box').submit();
        });


    });


    // pre-submit callback
    function showRequest(formData, jqForm, options) {


        for (var i=0; i < formData.length; i++) {
          if (!formData[i].value) {
              alert('表单值为空!');
              return false;
          }
        }
        return true;
    }

    // post-submit callback
    function showResponse(responseText, statusText)  {

        if(responseText.status=="success"){
            $().toastmessage('showSuccessToast', '操作成功');
            setTimeout(function () {location.reload()}, 1000);
        } else {
            $().toastmessage('showErrorToast', "操作失败");
        }

    }



    $("#key_name").autocomplete({

            source: function (query, process) {
                $.get("/content/item/autocomplete", {key: query, count:5}, function (respData) {
                    return process(respData);
                });
            },
            formatItem: function (item) {
                return item.title;
            },
            setValue: function (item) {
                console.log(item);
                console.log({'data-value': item.title, 'real-value': item.id});
                return {'data-value': "aa", 'real-value': 1};
            }
        });

  </script>
</div>
{% extends "base.html" %}
{% load util_tags %}
{% block link %}

    <link rel="stylesheet" href="{{ STATIC_URL }}file_upload/css/jquery.fileupload-ui.css">
    <link rel="stylesheet" href="{{ STATIC_URL }}file_upload/css/jquery.fileupload.css">

    <link rel="stylesheet" href="{{ STATIC_URL }}switchery/dist/switchery.css"/>
    <script src="{{ STATIC_URL }}switchery/dist/switchery.js"></script>
    <style type="text/css">
        div#addWrapper {
            text-align: center;
        }

        div#addPage {
            display: inline-block;
            text-align: left;
            margin-top: 20px;
        }

        table {
            border-collapse: separate !important;
            border-spacing: 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden
        }

        table td {
            vertical-align: top;
        }

        #main-content tbody tr {
            background-color: #fafafa;
        }

        .table tr:first-child td {
            border-top: none;
        }

        #img-content {
            max-height: 150px;
        }
    </style>
{% endblock %}
{% block content %}
    <div class="container">
        <div class="row-fluid">
            <div id="addWrapper">
                <div id="addPage">
                    <h4>视频修改</h4>

                    <form role="form" method="post" id="mainPageContent"
                          action="{% url 'search_back_img_update_video' video.id %}?device_type={{ device_type }}">
                        <input type="hidden" class="form-control" id="id" name="id" value="{{ video.id }}">

                        <table class="table table-hover table-striped">
                            <tr>
                                <td>直播ID</td>
                                <td>{{ video.video_id }}</td>
                            </tr>
                            <tr>
                                <td><span style="color: orangered">*</span>直播页面url:</td>
                                <td><textarea id="live_broadcast_url" name="live_broadcast_url"
                                              rows="5">{{ video.live_broadcast_url }}</textarea></td>
                            </tr>

                            <tr>
                                <td><span style="color: orangered">*</span>标题</td>
                                <td><input type="text" class="form-control" id="title" name="title"
                                           value="{{ video.title }}">
                                </td>
                            </tr>
                            <tr>
                                <td>子标题</td>
                                <td><input type="text" class="form-control" id="subtitle" name="subtitle"
                                           value="{{ video.subtitle }}"></td>
                            </tr>
                            <tr>
                                <td>腰封</td>
                                <td><input type="text" class="form-control" id="intro" name="intro"
                                           value="{{ video.intro }}">
                                </td>
                            </tr>
                            <tr>
                                <td><label><span style="color: orangered">*</span>
                                    图片{% if device_type == 'phone' %}(720*212) {% elif device_type == 'pad' %}
                                        (1280*172) {% endif %}</label></td>
                                <td>
                                    <div class="control-group">
                                        <label for="normal-input" class="control-label"></label>

                                        <div class="controls">
                                            <span id="normal-button" class="btn btn-success fileinput-button  btn-small">
                                                <span>+ 上传截图...</span>
                                                <input id="normal-upload" type="file" name="files[]" multiple>
                                            </span>

                                            <div id="normal-success" class="alert alert-success" style="{% if not video.h_image %}display: none;{% endif %}height: 200px;width: 160px">
                                                <button type="button" class="close">&times;</button>
                                                <img id='normal-content' src="{{ video.h_image }}" class="img-polaroid" style="height: 160px;width: 140px">
                                            </div>
                                            <div id="normal-progress"
                                                 class="progress progress-success progress-striped  active"
                                                 style="display: none">
                                                <div class="bar"></div>
                                            </div>
                                            <input type='hidden' id='normal-input' name='h_image' value="{{ video.h_image }}" height="100"
                                                   width="100"/>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>视频类型</td>
                                <td>{% show_video_type_human_readable video.video_type %}</td>
                            </tr>
                            <tr>
                                <td>是否付费:</td>
                                <td><select class="form-control" id="paid" name="paid" placeholder="">
                                    {% for live_paid in live_broadcast_paid %}
                                        <option value="{{ live_paid.id }}"
                                                {% ifequal live_paid.id video.paid %}
                                                selected="selected"
                                                {% endifequal %}
                                                >
                                            {{ live_paid.desc }}
                                        </option>
                                    {% endfor %}
                                </select></td>
                            </tr>

                        </table>

                        <input type="hidden" id="is_slider_box" name="is_slider_box" value="{{ is_slider_box }}">
                        <button type="submit" class="btn btn-default"><i class="icon-ok-sign"></i>确定</button>
                        <a class="btn btn-default"
                           href="{% url 'search_back_img_manage' %}?device_type={{ device_type }}"><i
                                class="icon-circle-arrow-left"></i>返回</a>

                    </form>
                </div>
            </div>
        </div>
    </div>
{% endblock %}



{% block js %}
    <script src="{{ STATIC_URL }}file_upload/js/vendor/jquery.ui.widget.js"></script>
    <script src="{{ STATIC_URL }}file_upload/js/jquery.iframe-transport.js"></script>
    <script src="{{ STATIC_URL }}file_upload/js/jquery.fileupload.js"></script>

    <script type="text/javascript">
        {% include "common_module/image_upload.js" %}

        $(function () {
            var img_upload_arr = ['normal'];
            for (var index = 0; index < img_upload_arr.length; index++) {
                add_upload_handler(generate_upload_dict(img_upload_arr[index]));
            }

            $(".alert button").click(function () {
                //此为点击“X”之后的一系列动作
                //btn 为<button type="button" class="close">&times;</button>
                var btn = $(this);
                $(btn).next().attr("src", "");
                parent = $(btn).parent();
                //隐藏
                parent.hide();
                //设置hidden input的值
                if (parent.next().next()) parent.next().next().val("");
                //显示上传按钮
                $(parent.parent().children()[0]).show();

            });
        });

    </script>
{% endblock %}

{% extends "base.html" %}

{% block link %}
    <style type="text/css">

        .img-polaroid {
            height: 70px !important;
        }

        .pagination {
            float: left;
            margin: 0 0 0 0;
        }

        div#btn-handle {
            clear: both;
        }

        span.current {
            vertical-align: 50%;
        }

        label.checkbox {
            margin: 0;
        }

        .batch {
            display: block;
            float: right;
            margin: 0 5px 0 5px;
        }

        .active-item-shadow {
            box-shadow: rgba(133, 133, 133, 0.1) 0 0 5px 2px, rgba(133, 133, 133, 0.3) 0 0 2px;
        }
    </style>
{% endblock %}

{% block content %}

    <div class="row-fluid input-prepend">
        <h3>子频道视频管理</h3>
        <span class="add-on">频道:</span>
        <select class="col-sm-8" id="select_channel" name="select_channel">
            {% for channel in channels %}
                {% ifequal this_channel.id channel.id %}
                    <option value="{{ channel.id }}" selected="selected">
                        {{ channel.title }}
                        ({% if channel.state == 1 %}开启{% else %}关闭{% endif %})
                    </option>
                {% else %}
                    <option value="{{ channel.id }}">{{ channel.title }}
                        ({% if channel.state == 1 %}开启{% else %}关闭{% endif %})
                    </option>
                {% endifequal %}
            {% endfor %}
        </select>
        {% if subchannels %}
            <span class="add-on" style="margin-left: 5px;">子频道:</span>
            <select class="col-sm-8" id="select_subchannel" name="select_subchannel">
                {% for subchannel in subchannels %}
                    {% ifequal this_subchannel.id subchannel.id %}
                        <option value="{{ subchannel.id }}" selected="selected">
                            {{ subchannel.title }}({% if subchannel.state == 1 %}开启{% else %}关闭{% endif %})
                        </option>
                    {% else %}
                        <option value="{{ subchannel.id }}">{{ subchannel.title }}
                            ({% if subchannel.state == 1 %}开启{% else %}关闭{% endif %})
                        </option>
                    {% endifequal %}
                {% endfor %}
            </select>
        {% endif %}
        {% if modules and this_subchannel.type == 1 %}
            <span class="add-on" style="margin-left: 5px;">子频道模块:</span>
            <select class="col-sm-8" id="select_module" name="select_module">
                {% for module in modules %}
                    {% ifequal this_module.id module.id %}
                        <option value="{{ module.id }}" selected="selected">
                            {{ module.title }}({% if module.state == 1 %}开启{% else %}关闭{% endif %})
                        </option>
                    {% else %}
                        <option value="{{ module.id }}">{{ module.title }}
                            ({% if module.state == 1 %}开启{% else %}关闭{% endif %})
                        </option>
                    {% endifequal %}
                {% endfor %}
            </select>
        {% endif %}
    </div>

    {% include "common_module/pagination.html" %}

    <table class="table table-striped table-hover table-condensed">
        <thead>
        <th><label class="checkbox"><input type="checkbox" id="all-check"></label></th>
        <th>视频id</th>
        <th>标题</th>
        {#        <th>副标题</th>#}
        <th>类型</th>
        <th>腰封</th>
        <th>创建日期</th>
        <th>横图</th>
        <th>竖图</th>
        <th>轮播图/游戏图</th>
        <th>版权</th>
        <th>付费</th>
        <th>状态(开/关)</th>
        <th>操作</th>
        </thead>

        <tbody id="sortable">
        {% for item in items %}
            <tr id="module_{{ item.id }}" value="{{ item.id }}" class="sort-item">
                <td><label class="checkbox"><input type="checkbox" class="parallel" value="{{ item.id }}"></label></td>
                <td>{{ item.video_id }}</td>
                <td>{{ item.title }}</td>
                {#                <td>{{ item.subtitle }}</td>#}
                <td>{{ item.video_type_name }}</td>
                <td> {% if item.intro %}
                    <a class="data_tip" href="#" data-toggle="tooltip"
                       title="{{ item.intro }}">{{ item.intro|slice:"10" }}...</a>
                {% endif %}
                </td>
                <td>{{ item.created_at }}</td>
                <td><img src="{{ item.h_image }}" style="height: 90px" class="img-polaroid"/></td>
                <td>
                    {% if item.v_image %}
                        <img src="{{ item.v_image }}" style="height: 90px" class="img-polaroid"/>
                    {% endif %}
                </td>
                <td>
                    {% if item.s_image %}
                        <img src="{{ item.s_image }}" style="height: 90px" class="img-polaroid"/>
                    {% endif %}
                </td>
                <td>{% if item.has_copyright %}有
                {% else %}
                    无
                {% endif %}
                </td>
                <td>
                    {% if item.paid %} 付费
                    {% else %} 免费{% endif %}
                </td>
                <td>

                    <a class="select_pick" href="#" id="status_{{ item.id }}" data-type="select"
                       data-pk="{{ item.id }}"
                       data-url="iphone/update_status/subchannel/module_v4/item?subchannel_id={{ this_subchannel.id }}&module_id={{ this_module.id }}"
                       data-title="状态管理" data-value={{ item.state }}></a>
                </td>

                <td colspan="2">

                    <a href="{% url "iphone_query_sub_channel_module_v4_item" %}?item_id={{ item.id }}&channel_id={{ this_channel.id }}&subchannel_id={{ this_subchannel.id }}&module_id={{ this_module.id }}">修改</a>
                    <a href="{% url "iphone_delete_sub_channel_module_v4_item" %}?item_id={{ item.id }}&channel_id={{ this_channel.id }}&subchannel_id={{ this_subchannel.id }}&module_id={{ this_module.id }}"
                       class="del">删除</a>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    {% if items %}
        <form method="post"
              action="{% url "iphone_mod_v4_update_batch_items" %}?page={{ now_page }}&channel_id={{ this_channel.id }}&subchannel_id={{ this_subchannel.id }}&module_id={{ this_module.id }}">
            <input type="submit" class="btn-small btn-inverse batch" id="batch-use" value="批量启用">
            <input type="submit" class="btn-small btn-inverse batch" id="batch-del" value="批量删除">
            <input type="hidden" id="del" name="del" value="0">
            <input type="hidden" id="del" name="use" value="0">
            <input type="hidden" id="pack_ids" name="pack_ids" value="">
        </form>
        {% include "common_module/pagination.html" %}
    {% endif %}

    {% if not channels %}
        <div class="row-fluid">
            <div class="col-sm-8">
                <div class="alert">
                    <button type="button" class="close" data-dismiss="alert">&times;</button>
                    <strong>Warning!</strong> 频道数据为空,请创建频道数据。
                    <a href="{% url 'iphone_channels' %}">创建频道</a>
                </div>
            </div>
        </div>
    {% else %}
        {% if not subchannels %}
            <div class="col-sm-8">
                <div class="alert">
                    <button type="button" class="close" data-dismiss="alert">&times;</button>
                    <strong>Warning!</strong> 子频道数据为空,请创建子频道数据。
                    <a href="{% url 'iphone_sub_channel' %}?select_channel={{ this_channel.id }}">创建子频道</a>
                </div>
            </div>
        {% else %}
            {% if this_subchannel.type == 1 and not modules %}
                <div class="col-sm-8">
                    <div class="alert">
                        <button type="button" class="close" data-dismiss="alert">&times;</button>
                        <strong>Warning!</strong> 当前子频道是模块类型,请创建模块。
                        <a href="{% url 'iphone_sub_channel_modules_v4' %}?select_channel={{ this_channel.id }}&select_subchannel={{ this_subchannel.id }}">创建模块</a>
                    </div>
                </div>


            {% else %}
                {% if not items %}
                    <div class="row-fluid">
                        <div class="col-sm-8">
                            <div class="alert">
                                <button type="button" class="close" data-dismiss="alert">&times;</button>
                                <strong>Warning!</strong> 子频道视频数据为空,请创建子频道视频数据。
                            </div>
                        </div>
                    </div>
                {% endif %}

                <div class="row-fluid" id="btn-handle" >
                    <form method="post" id="save_position_form">
                        <input type="hidden" name="item_ids" id="item_ids"/>
                        <input type="hidden" name="this_subchannel_id" id="this_subchannel_id"
                               value="{{ this_subchannel.id }}"/>
                        <input type="hidden" name="this_channel_id" id="this_channel_id" value="{{ this_channel.id }}"/>
                        <input type="hidden" name="this_module_id" id="this_module_id" value="{{ this_module.id }}"/>
                        <a class="btn btn-danger"
                           href="{% url 'iphone_add_sub_channel_module_v4_item' %}?channel_id={{ this_channel.id }}&subchannel_id={{ this_subchannel.id }}&module_id={{ this_module.id }}">新增内容</a>
                        <input type="submit" value="保存顺序" class="btn btn-primary" id="save_position_btn"/>
{#                        <a href="#syncJobModal" role="button" class="btn btn-info" data-toggle="modal">添加同步任务</a>#}
                        {#                        <a href="#syncList" role="button" class="btn btn-primary" data-toggle="modal">查看同步任务</a>#}
{#                        <a target="_blank"#}
{#                           href="{% url 'list_sync_plans' %}?select_channel={{ this_channel.id }}&select_subchannel={{ this_subchannel.id }}&select_module={{ this_module.id }}"#}
{#                           role="button" class="btn btn-primary">查看同步任务</a>#}
                        {#                        <a href="#syncDel" role="button" class="btn b</a>#}
                    </form>
                </div>

            {% endif %}

        {% endif %}
    {% endif %}
    {#    <div class="row-fluid">#}
    {#        {% include "subchannel_and_module_v4_items/add_syncjob.html" %}#}
    {#    </div>#}
    {#    <div class="row-fluid">#}
    {#        {% include "subchannel_and_module_v4_items/edit_syncjob.html" %}#}
    {#    </div>#}
{% endblock %}


{% block js %}

    <script type="text/javascript">

        {% include "common_module/sort_edit_del.js" %}

        $(document).ready(function () {

            $(".data_tip").tooltip();

            $("#select_channel").change(function () {
                channel_id = $(this).children('option:selected').val();
                window.location.href = "{% url 'iphone_sub_channel_module_v4_items' %}" + "?select_channel=" + channel_id;
            });

            $("#select_subchannel").change(function () {
                subchannel_id = $(this).children('option:selected').val();
                channel_id = $("#select_channel").val();
                window.location.href = "{% url 'iphone_sub_channel_module_v4_items' %}" + "?select_channel=" + channel_id + "&select_subchannel=" + subchannel_id;
            });

            $("#select_module").change(function () {
                module_id = $(this).children('option:selected').val();
                subchannel_id = $("#select_subchannel").val();
                channel_id = $("#select_channel").val();
                window.location.href = "{% url 'iphone_sub_channel_module_v4_items' %}" + "?select_channel=" + channel_id + "&select_subchannel=" + subchannel_id + "&select_module=" + module_id;
            });

        });
    </script>

    {% include "subchannel_and_module_items/batch_handle_js.html" %}
    <link href="{{ STATIC_URL }}bootstrap-editable-1.5.1/bootstrap-editable/css/bootstrap-editable.css"
          rel="stylesheet"/>
    <script src="{{ STATIC_URL }}bootstrap-editable-1.5.1/bootstrap-editable/js/bootstrap-editable.js"></script>

{% endblock %}
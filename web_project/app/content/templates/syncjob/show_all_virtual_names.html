{% extends "base.html" %}

{% block link %}
    <style type="text/css">
        #htop {
            display: inline-block;
        }

        .btn-top {
            float: right;
            display: inline-block;
        }

        .btn-top > .btn {
            margin-left: 10px;
        }

        .alert-info {
            margin-top: 20px;
        }

        #head_block {
            width: 100%;
        }

        #head_block a.btn {
            margin-top: 15px;
        }
    </style>

{% endblock %}

{% block content %}

    <div class="row-fluid">
        <div id="head_block">
            <h3 id="htop">虚名称管理</h3>
            {% url "show_single_plan" as from_single_plan %}
            {% if from_single_plan in request.META.HTTP_REFERER %}
                <div class="pull-right row">
                    <a class="btn" href="{{ request.META.HTTP_REFERER }}"><i class="icon-arrow-left"></i>返回</a>
                </div>
            {% endif %}
            {% url 'show_select_plans' as from_global_plans %}
            {% if from_global_plans in request.META.HTTP_REFERER %}
                <div class="pull-right row">
                    <a class="btn" href="{{ request.META.HTTP_REFERER }}"><i class="icon-arrow-left"></i>返回</a>
                </div>
            {% endif %}
        </div>
        <input type="hidden" id="platform" value="{{ platform }}">

    </div>
    <div>
        <div class="pull-left">
            <div class="input-prepend">
                <span class="add-on"><i class="icon-filter"></i>虚名称筛选</span>
                <input type="text" id="filter_name" data-original-title="" title="">
                <label for="filter_user_name"></label>
            </div>

        </div>
    </div>

    {% if v_names %}
        <table class="table table-striped table-hover">
            <thead>
            <th>调用id</th>
            <th>数据类型</th>
            <th>虚名称</th>
            <th>数据id</th>
            <th>操作</th>
            </thead>

            <tbody id="sortable">
            {% for v_name in v_names %}
                <tr id="module_{{ item.id }}" value="{{ job.id }}">
                    <td>{{ v_name.id }}</td>
                    <td>{{ v_name.type }}</td>
                    <td class="virtual_name">{{ v_name.name }}</td>
                    <td>{{ v_name.dataid }}</td>
                    <td colspan="2">
                        <a href="{% url 'single_virtual_name_fetch' %}?virtual_name={{ v_name.name }}" target="_blank">
                        查看该虚名称的抓取</a>
                    </td>
                </tr>
            {% endfor %}

            </tbody>
        </table>
    {% else %}
        <div>
            <div class="alert alert-info">
                <i class="icon-info-sign"></i>没有同步任务!
            </div>
        </div>
    {% endif %}


{% endblock %}


{% block js %}

    <script type="text/javascript">

        $(document).ready(function () {

            $('#filter_name').focus(function () {
                var pre_name = '';
                setInterval(function () {
                    var v_name = $('#filter_name').val();
                    if (v_name === '') {
                        $(".virtual_name").each(function () {
                            $(this).parent().show();
                        })
                    } else if (v_name !== pre_name) {
                        pre_name = v_name;
                        $(".virtual_name").each(function () {
                            if ($(this).text().indexOf(v_name) < 0) {
                                $(this).parent().hide();
                            } else {
                                $(this).parent().show();
                            }
                        })
                    }
                }, 500);
            });

            var run_type = $('#run_type');
            run_type.change(function () {
                if ($(this).val() === 'interval') {
                    $('#interval_type').show();
                    $('#cron_type').hide();
                } else {
                    $('#interval_type').hide();
                    $('#cron_type').show();
                }
            });
            run_type.triggerHandler('change');

            $(".data_tip").tooltip();

            $(".del").click(function () {

                var statu = confirm("确认删除吗?");
                if (!statu) {
                    return false;
                }
            });
            $(".run").click(function () {
                alert("任务已开始运行！");
            });

        });
    </script>
    <link href="{{ STATIC_URL }}bootstrap-editable-1.5.1/bootstrap-editable/css/bootstrap-editable.css"
          rel="stylesheet"/>
    <script src="{{ STATIC_URL }}bootstrap-editable-1.5.1/bootstrap-editable/js/bootstrap-editable.js"></script>

{% endblock %}